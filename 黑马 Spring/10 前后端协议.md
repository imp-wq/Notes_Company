## 协议

* 表现层数据封装模型，将数据放入一个对象，以便前后端交互。

  * data：存放数据。
  * code：标识操作的类型，成功与失败。
  * msg：提示信息。

  ```java
  public class Result {
      private Object data;
      private Integer code;
      private String message;
  }
  ```

## 异常处理

* 各个层均将异常往上抛，汇集到表现层统一处理。

* 利用AOP思想对异常进行处理。

* 在表现层controller中创建`ProjectExceptionAdvice`类处理异常。

  * 添加`@RestControllerAdvice`注解，注册为Spring MVC的异常处理类。

    该类需要被spring mvc加载。放在controller包中，可以被扫描到。

  * 在类中创建处理异常的方法，并通过`@ExceptionHandler(异常类.class)`注解设置该方法处理哪类异常。

  ```java
  @RestControllerAdvice
  public class ProjectExceptionAdvice {
      @ExceptionHandler(Exception.class)
      public Result handleException(Exception exception) {
          return new Result(0, null,"发成了错误");
      }
  }
  ```


### 异常分类处理方案

* 业务异常Business Exception
  * 不规范用户行为产生的异常
  * 发送消息给客户，提醒规范操作
* 系统异常System Exception
  * 项目运行中可预计但无法避免的异常
  * 安抚用户，告知运维，记录日志。
* 其他异常
  * 预计不到的异常
  * 安抚用户，告知运维，记录日志。

#### exception包

新建exception包用户存放异常的类。

* 创建code字段用于记录错误码，对异常进行分类。

* 创建自定义异常类，extends RuntimeException。

  ```java
  public class BusinessException extends RuntimeException {
      private Integer code;
  
      public BusinessException(Integer code) {
          this.code = code;
      }
  
      public Integer getCode() {
          return code;
      }
  
      public void setCode(Integer code) {
          this.code = code;
      }
  
      public BusinessException(String message, Integer code) {
          super(message);
          this.code = code;
      }
  
      public BusinessException(String message, Throwable cause, boolean enableSuppression, boolean writableStackTrace, Integer code) {
          super(message, cause, enableSuppression, writableStackTrace);
          this.code = code;
      }
  }
  ```

* 在Service层根据异常发生位置，通过try-catch代码块，对异常进行重新分类，抛出自定义异常。

  ```java
  try {
  	// 业务逻辑...
  }catch (Exception e) {
      // 抛出业务异常
      throw new BusinessException(222,"服务器访问超时，请重试");
  }
  ```

  

* 对自定义异常进行分类处理。

  controller-ProjectExceptionAdvice类

  ```java
  @ExceptionHandler(SystemException.class)
  public Result handleSystemException(SystemException exception) {
      // 记录日志
      // 发送消息给运维和开发人员
      // 数据为null，code和message直接从传入的异常中获取。
      return new Result(exception.getCode(), null, exception.getMessage());
  }
  ```

  * SystemException：
    * 记录日志
    * 发送消息给运维和开发人员
    * 发送消息安抚用户
  * BusinessException：
    * 直接发送消息给用户即可
  * Exception：用于处理未知错误。
    * 记录日志
    * 发送消息给运维和开发人员
    * 发送消息安抚用户

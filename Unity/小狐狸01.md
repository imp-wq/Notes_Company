## 基本操作

* 左上工具栏：qwerty快捷键切换。

### 图层

* 通过对hierarchy中的元素的Additional Setting->sorting layer进行添加和设置，设置展示图层的先后顺序。sorting layer越靠下在屏幕上越靠前。

## Tilemap

* tilemap：需要添加到左侧Hierarchy边栏中才能生效。即active tilemap那里不能是nothing。
* add component->tilemap collider 2D: 使tilemap具有碰撞体积。

## 角色控制

* hierarchy中创建sprite，将角色的模型拖入到其Sprite中，使用sprite来承载角色。

### Add Component

Add component用于为角色添加一些属性。

* Physics 2D:
  * Rigidbody 2D：刚体，选择后可以设置质量等。
  * Box collider 2D：碰撞体，可以通过edit collider编辑碰撞体积大小。
* 防止角色horizontal方向移动时，vertical方向发生偏移：Rigidbody 2D->Constrains->Freeze Rotation Z勾选。

### 键位设置

* Edit->Project->Input Manager

### C# Script

#### 移动

* 通过add component添加c# script，默认在assets根目录下，应当统一放到Scripts目录中。

* 双击打开。

* Input.GetAxis("Horizontal"); 能获得3个参数：

  通过该方法判断键盘按下，进行移动。

  * -1：左
  * 1：右
  * 0：没动

* Rigidbody.velocity：是一个Vector2类型的属性，即2D向量。

  通过该属性为角色添加相应方向的速度。

* 游戏运行过程中调整的参数不会被保存，可以copy component，结束后再paste component。

* Update方法会在每一帧被调用，因此需要被每一帧调用的方法，应当放到update中。

##### 优化

* Update->FixedUpdate：固定帧率，不会导致在帧率不同的设备上运行效果不一样。
* 速度：*Time.deltaTime，保证速度的稳定。使用该属性后，对比不使用时，speed要大幅增加（10->500）。

### Animator

* 新建Animations文件夹，在其中Create Animator Controller，拖到角色上。
* 为角色添加动画：
  * Window中打开Animation窗口，create创建新动画，选择角色，将素材拖到时间轴上。
  * 设置动画快慢：拖动时间轴控制动画的时间，或者通过时间轴右上`...`show sample rate打开后，设置采样频率。
  * 添加完毕后动画会作为Animator的一个state。
* Animator状态转换：
  * 右击状态->make transition
  * 选择Parameter tab，添加参数running，用于idle与running状态间切换。
  * 在transition的箭头中，通过condition设置转换的条件，即parameter less/greater than xxx。

* c# script控制animator state转换：
  * 设置animator field。
  * unity中将角色animator拖入c# player controller script。
  * 移动逻辑：将horizontal取到的值，加绝对值，赋给running parameter。
  * 操作Animator中的参数：`animator.GetFloat("参数名")` 数学库：`Mathf`

### SwitchAnimation

* 专门创建SwitchAnimation方法，用于控制角色running, idling, jumping, falling 等不同状态的动画。

### 检测碰撞到地面

* 用于从falling状态切换回idling状态。
* 新建layer名为ground，为tilemap选择ground layer。
* c# script中设置LayerMask类型字段ground，将ground layer赋值给该字段。
* 通过监测碰撞地面，falling->idling：
  * 通过注册Collider2D字段，调用其IsTouchingLayers方法判断是否与ground layer碰撞。

### 优化：移动卡顿

* 原因：只使用一个box collider时，会与地面进行碰撞，从而导致移动卡顿。

* 解决：只在头部使用box collider，脚部添加一个circle collider用于与地面碰撞，从而避免box间碰撞的卡顿问题。

  注意在检测与地面碰撞时，应当使用circle collider。

### 代码优化：固定私有字段

* 将一些固定且唯一的字段设置为私有字段，如rigitBody，animator等，在start生命周期中使用`GetComponent<类型>`的方式进行赋值。
* 如果需要显示私有字段，使用`[SerializeField]`修饰符。

## Camera

* 镜头跟随角色：

  * 创建camera controller script用于控制摄像机。
  * 创建transform类型字段player，用于获取角色的位置。

* 使用cinemachine package：

  * window->package manager, install
  * GameObject->cinemachine->进行设置：
    * follow：设置跟踪的对象。
    * dead zone：角色在该区域中移动时，摄像头不会移动。

* 限制camera不会超出背景：

  * 为background添加collider，使用polygon collider，框出背景的区域。

    勾选is Trigger防止对角色产生影响。

  * cinemachine camera->Extension, adding extension->cinemachine confiner，bounding shape选择background

